{"ast":null,"code":"// src/App.js (Versão Corrigida e Melhorada)\nimport React,{useState,useEffect}from'react';import{useFirebaseAuth}from'./hooks/useFirebaseAuth';import{clientService,subscriptionService,invoiceService,seedService}from'./services/firestore';import{ROUTES}from'./utils/constants';// Componentes\nimport Header from'./components/common/Header';import LoadingSpinner from'./components/common/LoadingSpinner';import LoginPage from'./components/auth/LoginPage';import FirebaseSetup from'./components/auth/FirebaseSetup';import Dashboard from'./components/dashboard/Dashboard';import ClientsPage from'./components/clients/ClientsPage';import ReportsPage from'./components/reports/ReportsPage';// Estilos\nimport'./styles/globals.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function App(){const{user,loading:authLoading,signIn,logout}=useFirebaseAuth();const[currentView,setCurrentView]=useState(ROUTES.DASHBOARD);const[dataLoading,setDataLoading]=useState(false);const[error,setError]=useState(null);// Novo estado para erros\n// Estados dos dados\nconst[clients,setClients]=useState([]);const[subscriptions,setSubscriptions]=useState([]);const[invoices,setInvoices]=useState([]);// Verificar se Firebase está configurado\nconst isFirebaseConfigured=()=>{const requiredVars=['REACT_APP_FIREBASE_API_KEY','REACT_APP_FIREBASE_PROJECT_ID'];return requiredVars.every(envVar=>process.env[envVar]);};// Carregar dados do usuário\nconst loadUserData=async()=>{if(!user)return;setDataLoading(true);setError(null);// Limpa erros anteriores\ntry{const[clientsData,subscriptionsData,invoicesData]=await Promise.all([clientService.getAll(),subscriptionService.getAll(),invoiceService.getAll()]);setClients(clientsData);setSubscriptions(subscriptionsData);setInvoices(invoicesData);}catch(e){console.error('Erro ao carregar dados do usuário:',e);setError('Falha ao carregar os dados. Verifique suas regras de segurança do Firestore e a conexão com a internet.');}finally{setDataLoading(false);}};// Criar dados de exemplo\nconst handleCreateSampleData=async()=>{if(!user)return;if(clients.length>0){alert('Dados de exemplo já existem!');return;}setDataLoading(true);setError(null);try{const result=await seedService.createSampleData();if(result.success){await loadUserData();alert('Dados de exemplo criados com sucesso!');}else{alert('Erro ao criar dados de exemplo: '+result.error);}}catch(e){console.error('Erro ao criar dados de exemplo:',e);alert('Erro ao criar dados de exemplo');setError('Falha ao criar dados de exemplo.');}finally{setDataLoading(false);}};// Carregar dados quando usuário faz login\nuseEffect(()=>{if(user){loadUserData();}else{// Limpar dados quando usuário faz logout\nsetClients([]);setSubscriptions([]);setInvoices([]);}},[user]);// Loading inicial da autenticação\nif(authLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 flex items-center justify-center\",children:/*#__PURE__*/_jsx(LoadingSpinner,{size:\"large\",message:\"Carregando Autentica\\xE7\\xE3o...\"})});}// Firebase não configurado\nif(!isFirebaseConfigured()){return/*#__PURE__*/_jsx(FirebaseSetup,{});}// Usuário não autenticado\nif(!user){return/*#__PURE__*/_jsx(LoginPage,{onLogin:signIn});}// Se houver um erro no carregamento dos dados, exibe a mensagem\nif(error){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 flex items-center justify-center text-center p-4\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-red-600 mb-4\",children:\"Ocorreu um Erro\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700\",children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:loadUserData,className:\"mt-6 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\",children:\"Tentar Novamente\"})]})});}// Aplicação principal\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gray-50\",children:[/*#__PURE__*/_jsx(Header,{user:user,onLogout:logout,currentView:currentView,onViewChange:setCurrentView,onCreateSampleData:handleCreateSampleData}),/*#__PURE__*/_jsx(\"main\",{className:\"container mx-auto px-4 py-8\",children:dataLoading?/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-12\",children:/*#__PURE__*/_jsx(LoadingSpinner,{size:\"medium\",message:\"Carregando dados...\"})}):/*#__PURE__*/_jsxs(_Fragment,{children:[currentView===ROUTES.DASHBOARD&&/*#__PURE__*/_jsx(Dashboard,{invoices:invoices,setInvoices:setInvoices,clients:clients}),currentView===ROUTES.CLIENTS&&/*#__PURE__*/_jsx(ClientsPage,{clients:clients,setClients:setClients,subscriptions:subscriptions,setSubscriptions:setSubscriptions}),currentView===ROUTES.REPORTS&&/*#__PURE__*/_jsx(ReportsPage,{invoices:invoices,clients:clients})]})})]});}export default App;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}